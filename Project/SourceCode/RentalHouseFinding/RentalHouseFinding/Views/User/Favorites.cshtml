@{
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
    ViewBag.Title = "Lịch sử giao dịch";
}

<fieldset>
    <div id="container-grid">
        @{
            if (ViewBag.Grid != null && ViewBag.Grid.TotalRowCount > 0)
            {
                var grid = (WebGrid)ViewBag.Grid;

                @grid.GetHtml(tableStyle: "", mode: WebGridPagerModes.All,
                                headerStyle: "header",
                                alternatingRowStyle: "alt",
                                htmlAttributes: new { id = "grid" },
                                columns: grid.Columns(
                                        grid.Column(header: "STT", format: item => item.WebGrid.Rows.IndexOf(item) + 1 + ViewBag.Index),
                                        grid.Column(header: "Tiêu đề", format: @<text>
                                        <a href="@Url.Action("Details", "Post",
                                        new { id = @item.ID })">@item.Title</a></text>),
                                        grid.Column("Address", "Địa chỉ"),
                                        grid.Column("UserName", "Người đăng"),
                                        grid.Column("PostStatus", "Trạng thái"),
                                        grid.Column("AddedDate", "Ngày thêm",
                                        format: (item) => string.Format("{0:yyyy-MM-dd HH:mm:ss}", item.AddedDate)),
                                        grid.Column(header: "Gỡ", format: item => @Html.ActionLink("Gỡ khỏi danh mục", "", null, new {id = item.ID}))
                                ));
            }
            else
            {
                <div id="message-sv" style="width:967px; margin: 0 auto;">
                    <div class="message-notification message-information">
                        <a class="close" id="btnCloseDiv"></a>
                        <div>
                            Bạn chưa có bài nào ở trong danh sách này :)
                        </div>
                    </div>
                </div>
            }
    
    }
    <br/>
    <br/>
</div>
</fieldset>
<script type="text/javascript" >
    $(document).ready(function () {
        $("#options a").removeClass("active");
        $("#btnDanhSach").addClass('active');
        $('a[href="#"]').live('click', function (event) {
            event.preventDefault();
        });
        $('a[href="/user"]').live('click', function (event) {
            event.preventDefault();
            debugger;
            removeFavorite($(this).prop('id'));
            $(this).parent().parent().remove();
        });
    });
    
    function removeFavorite(id) {
        if (!confirm("Xóa khỏi danh mục?")) {
            return false;
        }
        $.getJSON("/Post/RemoveFavorite", { id: id }, function (success) {
            if (success) {
                alert('Đã xóa bài khỏi danh mục');
            }
        });
        
    }
</script>
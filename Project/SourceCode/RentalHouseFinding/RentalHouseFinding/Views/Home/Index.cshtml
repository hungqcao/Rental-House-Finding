@model RentalHouseFinding.Models.SearchViewModel
@{
    ViewBag.Title = "Index";
    Uri auxBaseUri = new Uri(Request.Url.GetLeftPart(UriPartial.Authority));
    Uri baseUri = new Uri(auxBaseUri, Url.Content("~")); 
}
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>

<script src="@Url.Content("~/Scripts/markerclusterer.js")" type="text/javascript"></script>

@*fancy box*@
<script src="@Url.Content("~/Content/fancybox/jquery.easing-1.3.pack.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/fancybox/jquery.fancybox-1.3.4.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/fancybox/jquery.fancybox-1.3.4.pack.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/fancybox/jquery.mousewheel-3.0.4.pack.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/fancybox/jquery.fancybox-1.3.4.css")" rel="stylesheet" type="text/css" />

<script src="@Url.Content("~/Scripts/RHFScripts.js")" type="text/javascript"></script> 
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" />
@*Group Marker*@
<script src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
    function initialize() {
        var mapOptions = {
            zoomControl: true,
            zoom: 13,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        window.map = new google.maps.Map(document.getElementById('infoMap'),
            mapOptions);
        var i = 0;
        var markers1 = [];
        var markers = { marker: [] };
        var imageInactive = '@Url.Content("~/Content/images/inactive_marker.png")';
        var imageActive = '@Url.Content("~/Content/images/active_marker.png")';

        //var bounds = new google.maps.LatLngBounds();
        //        function initialize() {
        
        var infowindow;
        //=======For Group Marker=======

        //===========End================



        $.getJSON("home/GetLatLonFromResult",
            function (myData) {
                source = myData;

                var markerImg = new google.maps.MarkerImage(imageInactive);
                var altMarkerImg = new google.maps.MarkerImage(imageActive);
                $.each(source, function (index, itemData) {
                    if (itemData.Text.length != 0) {
                        marker = new google.maps.Marker({
                            position: new google.maps.LatLng((itemData.Text.split('|')[0]), (itemData.Text.split('|')[1])),
                            map: window.map,
                            icon: markerImg,
                            animation: google.maps.Animation.DROP
                        });
                        var latLonToSet = new google.maps.LatLng((itemData.Text.split('|')[0]), (itemData.Text.split('|')[1]));
                        window.map.setOptions({
                            center: latLonToSet,
                            zoom: 14
                        });
                        i++;
                        infowindow = new google.maps.InfoWindow();
                        google.maps.event.addListener(marker, 'click', (function (marker, i) {
                            return function () {
                                var valuePost = itemData.Text.split('|');
                                infowindow.setContent('<div class="1">'
                                + '<h3>' + valuePost[5] + '</h3>'
                                + '<br/>'
                                + '<h4>' + valuePost[4] + '<h4>'
                                + '<br/>'
                                + '<br/>'
                                + 'Diện tích:' + valuePost[2] + ' m2' + '  |  Giá:' + valuePost[3] + 'triệu VNĐ'
                                + '<br/>'
                                + '<a class="infoDetail left fancybox" href="/post/detailsbox/' + itemData.Value + '">Xem chi tiết</a>'
                                + '</div>');
                                infowindow.open(window.map, marker);
                            }
                        })(marker, i));
                        markers.marker.push({ "id": itemData.Value, "value": marker });
                        markers1.push(marker);
                        //bounds.extend(latLonToSet);
                    }
                });
                var markerCluster = new MarkerClusterer(window.map, markers1, {
                    zoomOnClick: false,
                    maxZoom: 18,
                    gridSize: 50
                });

            });

        $("#ul-result li a").mouseover(function () {
            var id = $(this).attr('id').split('-')[1];
            for (var key in markers.marker) {
                if (markers.marker[key].id == id) {
                    markers.marker[key].value.setIcon(imageActive);
                }
            }
        }).mouseout(function () {
            var id = $(this).attr('id').split('-')[1];
            for (var key in markers.marker) {
                if (markers.marker[key].id == id) {
                    markers.marker[key].value.setIcon(imageInactive);
                }
            }
        });
    }

    function loadScript() {
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&' +
            'callback=initialize';
        document.body.appendChild(script);
    }

    window.onload = loadScript;
</script>



<script type="text/javascript">
    $(document).ready(function () {

        var source;
        $.ajax({
            url: 'home/GetSectionSideListPost',
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            data: {
                skipNum: 0,
                takeNum: 10
            }
        })
        .success(function (result) {
            $('#ul-result').append(result);
            $("a.fancybox").fancybox({
                'width': '85%',
                'height': '100%',
                'type': 'iframe'
            });
            UpdateNumberListItem();

        })
        .error(function (xhr, status) {
            xhr.abort();
        });
    });
</script>
@using (Html.BeginForm())
{
    <div id="options">
        <div id="btnShowList" onclick="toggle_visibility('listInfo');" class="btnShowListClicked"></div>
        @Html.DropDownListFor(model => model.ProvinceId, (IEnumerable<SelectListItem>)ViewBag.ProvinceId, new { @class = "select narrow" })
        @Html.ValidationMessageFor(model => model.ProvinceId)
        @Html.DropDownListFor(model => model.DistrictId,
            new SelectList(Enumerable.Empty<SelectListItem>(), "Id", "Name"), "Chọn Quận/Huyện",
                    new { @id = "DistrictId", @class = "select narrow" })
        @Html.DropDownListFor(model => model.CategoryId, (IEnumerable<SelectListItem>)ViewBag.CategoryId, new { @class = "select narrow" })
        @Html.ValidationMessageFor(model => model.CategoryId)
        <div class="textbox">
            @Html.TextBoxFor(model => model.KeyWord, new { @id = "KeyWord", @class = "searchMid", @placeholder = "từ khóa thêm", @style = "width: 231px; font-size: 12px;" })        
        </div>
        <input type="submit" id="btnSubmit" value="" />
    </div>
}
<div class="clear"></div>
<div class="success-mess">
                
</div>
<div id="listInfo" class="left" style="display: block;">
    <label id="numberItem" style="float: left; margin-left: 15px;"></label>
    <div class="clear"></div> 
    <div id="wrapperDiv" class="scroll-pane">
        <div id="mainDiv">
            <ul id="ul-result">
            </ul>
        </div>
    </div>
    <div id="overlay">
       <img src="@Url.Content("~/Content/images/ajax-loader.gif")" />
    </div>
    
</div>
<div class="map_wrapper" style="border:1px solid #bebebe;
                                background-color: white;
                                overflow: hidden;
                                margin: 0 auto;">
    <div id = "map" style="margin: 5px">
        <div id="infoMap">
        
        </div>
    </div>
</div>
<div class="clear"></div>

@section head{
    <script type="text/javascript">
        function UpdateNumberListItem() {
            var count = $("#ul-result").children().length;
            $("#numberItem").html("<strong>" + count + "</strong> kết quả");
        }
        $(document).ready(function () {
            $("#overlay").fadeOut();
            $("#wrapperDiv").scroll(function () {
                // We check if we're at the bottom of the scrollcontainer
                if ($(this)[0].scrollHeight - $(this).scrollTop() == $(this).outerHeight()) {
                    $("#overlay").fadeIn();
                    // If we're at the bottom, show the overlay and retrieve the next page
                    $.ajax({
                        url: 'home/GetSectionSideListPost',
                        contentType: 'application/html; charset=utf-8',
                        type: 'GET',
                        dataType: 'html',
                        data: {
                            skipNum: 0,
                            takeNum: 10
                        }
                    })
                    .success(function (result) {
                        $('#ul-result').append(result);
                        $("a.fancybox").fancybox({
                            'width': '85%',
                            'height': '100%',
                            'type': 'iframe'
                        });
                        $("#overlay").fadeOut();
                        UpdateNumberListItem();
                    })
                    .error(function (xhr, status) {
                        xhr.abort();
                    });
                }
            });
            $('select.select').each(function () {
                var title = $(this).attr('title');
                var id = $(this).attr('id');
                if ($('option:selected', this).val() != '') {
                    title = $('option:selected', this).text();
                } else {
                    $('option:selected', this).val('0');
                    title = $('option:selected', this).val('0').text();
                }
                $(this)
                .css({ 'opacity': 0 })
                .after('<span class="select" id="sp' + id + '">' + title + '</span>')
                .change(function () {
                    val = $('option:selected', this).text();
                    $(this).next().text(val);
                })
            });
            //            $(function () {
            //                $('.scroll-pane').jScrollPane();
            //            });

        });
        </script>
}
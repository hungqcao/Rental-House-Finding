@model RentalHouseFinding.Models.SearchViewModel
@{
    ViewBag.Title = "Index";
    Uri auxBaseUri = new Uri(Request.Url.GetLeftPart(UriPartial.Authority));
    Uri baseUri = new Uri(auxBaseUri, Url.Content("~")); 
}
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-1.5.1.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>
<script src="http://maps.googleapis.com/maps/api/js?sensor=false" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/RHFScripts.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/DDLScripts.js")" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var source;
        $.ajax({
            url: 'home/GetSectionSideListPost',
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            data: {
                skipNum: 0,
                takeNum: 10
            }
        })
        .success(function (result) {
            $('#postContent').html(result);
        })
        .error(function (xhr, status) {
            xhr.abort();
        });

        var marker;
        var map;
        var i = 0;

        function initialize() {
            var mapProp = {
                center: new google.maps.LatLng('1', '1'),
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var infowindow;
            map = new google.maps.Map(document.getElementById("mapContainer"), mapProp);
        }
        $.getJSON("home/GetLatLonFromResult",
            function (myData) {
                source = myData;

                $.each(source, function (index, itemData) {
                    if (itemData.Text.length != 0) {
                        marker = new google.maps.Marker({
                            position: new google.maps.LatLng((itemData.Text.split(';')[0]), (itemData.Text.split(';')[1])),
                            map: map
                        });
                        var latLonToSet = new google.maps.LatLng((itemData.Text.split(';')[0]), (itemData.Text.split(';')[1]));
                        map.setOptions({
                            center: latLonToSet,
                            zoom: 11
                        });
                        i++;
                        infowindow = new google.maps.InfoWindow();
                        google.maps.event.addListener(marker, 'click', (function (marker, i) {
                            return function () {
                                infowindow.setContent(itemData.Value);
                                infowindow.open(map, marker);
                            }
                        })(marker, i));
                    }
                });
            });
        
        google.maps.event.addDomListener(window, 'load', initialize);
        google.setOnLoadCallback(initialize(source));
    });
</script>

<div id="filter-search-bar">
    @Html.DropDownList("CategoryId", null, new { @class = "select" })
    @Html.ValidationMessageFor(model => model.CategoryId)
	@Html.DropDownList("ProvinceId", (IEnumerable<SelectListItem>)ViewBag.ProvinceId, "Chọn Tỉnh/Thành phố", new { @class = "select" })
    @Html.ValidationMessageFor(model => model.ProvinceId)   
	@Html.DropDownListFor(model => model.DistrictId,
        new SelectList(Enumerable.Empty<SelectListItem>(), "Id", "Name"), "Chọn Quận/Huyện",
        new { @id = "DistrictId", @class = "select" })
	@Html.TextBoxFor(model => model.KeyWord, new { @id = "KeyWord", @class = "txt" })
    <input type="submit" value="Submit" class="submit"/>
</div>
<div class="success-mess">
                
</div>
<div id= "view-result-page">
    <div id = "postContent" class="fl_l" ></div>
    <div class = "map fl_r">
        <div id="mapContainer" ></div>
    </div>
    <div class = "clear">
    </div>
</div>

@model RentalHouseFinding.Models.SearchViewModel
@{
    ViewBag.Title = "Index";
    Uri auxBaseUri = new Uri(Request.Url.GetLeftPart(UriPartial.Authority));
    Uri baseUri = new Uri(auxBaseUri, Url.Content("~")); 
}
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
<script src="http://maps.googleapis.com/maps/api/js?sensor=false" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/RHFScripts.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery-ui-1.8.11.min.js")" type="text/javascript"></script>

<script type="text/javascript">
    $(document).ready(function () {
        var source;
        $.ajax({
            url: 'home/GetSectionSideListPost',
            contentType: 'application/html; charset=utf-8',
            type: 'GET',
            dataType: 'html',
            data: {
                skipNum: 0,
                takeNum: 10
            }
        })
        .success(function (result) {
            $('.scroll-pane').html(result);
        })
        .error(function (xhr, status) {
            xhr.abort();
        });

        var marker;
        var map;
        var i = 0;

        function initialize() {
            var mapProp = {
                center: new google.maps.LatLng('1', '1'),
                zoom: 16,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            var infowindow;
            map = new google.maps.Map(document.getElementById("infoMap"), mapProp);
        }
        $.getJSON("home/GetLatLonFromResult",
            function (myData) {
                source = myData;

                $.each(source, function (index, itemData) {
                    if (itemData.Text.length != 0) {
                        marker = new google.maps.Marker({
                            position: new google.maps.LatLng((itemData.Text.split(';')[0]), (itemData.Text.split(';')[1])),
                            map: map
                        });
                        var latLonToSet = new google.maps.LatLng((itemData.Text.split(';')[0]), (itemData.Text.split(';')[1]));
                        map.setOptions({
                            center: latLonToSet,
                            zoom: 11
                        });
                        i++;
                        infowindow = new google.maps.InfoWindow();
                        google.maps.event.addListener(marker, 'click', (function (marker, i) {
                            return function () {
                                infowindow.setContent(itemData.Value);
                                infowindow.open(map, marker);
                            }
                        })(marker, i));
                    }
                });
            });
        
        google.maps.event.addDomListener(window, 'load', initialize);
        google.setOnLoadCallback(initialize(source));
    });
</script>
<div id="options">
    <div id="btnShowList" onclick="toggle_visibility('listInfo');" class="btnShowListNormal"></div>
    @Html.DropDownListFor(model => model.ProvinceId, (IEnumerable<SelectListItem>)ViewBag.ProvinceId, new { @class = "select narrow" })
    @Html.ValidationMessageFor(model => model.ProvinceId)
    @Html.DropDownListFor(model => model.DistrictId,
        new SelectList(Enumerable.Empty<SelectListItem>(), "Id", "Name"), "Chọn Quận/Huyện",
                new { @id = "DistrictId", @class = "select narrow" })
    @Html.DropDownListFor(model => model.CategoryId, null, new { @class = "select narrow" })
    @Html.ValidationMessageFor(model => model.CategoryId)
    <select id="ddlPrice" class="select wide">
            <option value="HN">2 - 3 triệu VND</option>
            <option value="DN">3 - 6 triệu VND</option>
            <option value="HCM">>6 triệu VND</option>
    </select>
    <select id="ddlArea" class="select narrow">
            <option value="HN">10 - 15 m2</option>
            <option value="DN">15 - 25 m2</option>
            <option value="HCM">>25 m2</option>
    </select>
    <div class="textbox">
        @Html.TextBoxFor(model => model.KeyWord, new { @id = "KeyWord", @class = "searchMid", @placeholder = "từ khóa thêm", @style="width: 231px; font-size: 12px;" })        
    </div>
    <input type="submit" id="btnSubmit" value="" />
</div>
<div class="clear"></div>
<div class="success-mess">
                
</div>
<div id="listInfo" class="left" style="display: none;">
    <label style="margin-left: 15px;">Sắp xếp theo:</label>
    <select id="ddlSortBy" class="select sortBy">
            <option value="HN">Diện tích</option>
            <option value="DN">Giá cả</option>
            <option value="HCM">Khoảng cách</option>
    </select>
    <label style="float: right; margin-right: 15px;"><b>700</b> kết quả</label>
    <div class="clear"></div> 
    <div class="scroll-pane">
        
    </div>
</div>
<div id="infoMap" class="left">
    @*<div id="mapContainer" style="width:500px;height:380px;"></div>*@
</div>
<div class="clear"></div>

@section head{
    <script type="text/javascript">

        $(function () {
            var pathToImageCbx = '@Url.Content("~/Content/images/index_cbx.png")';
            $('input:checkbox').screwDefaultButtons({
                image: "url(" + pathToImageCbx + ")",
                width: 17,
                height: 17
            });
        });

        function toggle_visibility(id) {
            var e = document.getElementById(id);

            if (e.style.display == 'block') {
                e.style.display = 'none';
                if (e.id == 'listInfo') {
                    $('#infoMap').width('100%');
                    document.getElementById('btnShowList').setAttribute('class', 'btnShowListNormal');
                }
            } else {
                e.style.display = 'block';
                if (e.id == 'listInfo') {
                    $('#infoMap').width('720px');
                    document.getElementById('btnShowList').setAttribute('class', 'btnShowListClicked');
                }
            }
        }

        $(document).ready(function () {
            $('select.select').each(function () {
                var title = $(this).attr('title');
                var id = $(this).attr('id');
                if ($('option:selected', this).val() != '') {
                    title = $('option:selected', this).text();
                } else {
                    $('option:selected', this).val('0');
                    title = $('option:selected', this).val('0').text();
                }
                $(this)
                .css({ 'opacity': 0 })
                .after('<span class="select" id="sp' + id + '">' + title + '</span>')
                .change(function () {
                    val = $('option:selected', this).text();
                    $(this).next().text(val);
                })
            });
            $(function () {
                $('.scroll-pane').jScrollPane();
            });
        });
        </script>
}